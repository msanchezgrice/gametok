<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Word Guess</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }

        #game-container {
            width: 100%;
            max-width: 400px;
            padding: 20px;
            text-align: center;
        }

        #score-display {
            font-size: 24px;
            color: white;
            margin-bottom: 20px;
            font-weight: bold;
        }

        #category-display {
            font-size: 18px;
            color: rgba(255,255,255,0.8);
            margin-bottom: 10px;
        }

        #word-display {
            font-size: 36px;
            letter-spacing: 10px;
            color: white;
            margin: 30px 0;
            font-weight: bold;
            min-height: 50px;
        }

        #hint-display {
            font-size: 16px;
            color: rgba(255,255,255,0.9);
            margin: 20px 0;
            min-height: 24px;
            font-style: italic;
        }

        #keyboard {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin: 20px auto;
            max-width: 350px;
        }

        .key {
            padding: 15px 10px;
            background: white;
            color: #667eea;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }

        .key:active {
            transform: scale(0.95);
        }

        .key.used {
            background: rgba(255,255,255,0.3);
            color: rgba(255,255,255,0.5);
            cursor: not-allowed;
        }

        .key.correct {
            background: #4CAF50;
            color: white;
        }

        .key.wrong {
            background: #f44336;
            color: white;
        }

        #lives-display {
            font-size: 30px;
            margin: 20px 0;
        }

        #start-screen, #game-over-screen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 100;
        }

        #game-over-screen {
            display: none;
        }

        .game-button {
            margin-top: 20px;
            padding: 18px 40px;
            font-size: 24px;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .game-button:active {
            transform: scale(0.95);
        }

        h1 {
            font-size: 48px;
            margin-bottom: 20px;
        }

        #streak-display {
            font-size: 20px;
            color: #FFD700;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="score-display">Score: 0</div>
        <div id="streak-display"></div>
        <div id="category-display"></div>
        <div id="word-display"></div>
        <div id="hint-display"></div>
        <div id="lives-display"></div>
        <div id="keyboard"></div>
    </div>

    <div id="start-screen">
        <h1>üìù Word Guess</h1>
        <p style="font-size: 20px; margin-bottom: 10px;">Guess the hidden word!</p>
        <p style="font-size: 16px; opacity: 0.8;">Choose letters to reveal the word</p>
        <button class="game-button" onclick="startGame()">START GAME</button>
    </div>

    <div id="game-over-screen">
        <h1 id="game-over-title">Game Over!</h1>
        <div id="final-score" style="font-size: 36px; margin: 20px 0; color: #FFD700;"></div>
        <p id="game-over-message" style="font-size: 18px; margin: 10px 0;"></p>
        <button class="game-button" onclick="startGame()">PLAY AGAIN</button>
    </div>

    <script>
        const words = [
            { word: 'GALAXY', category: 'Space', hint: 'A system of stars' },
            { word: 'OCEAN', category: 'Nature', hint: 'Large body of water' },
            { word: 'PYRAMID', category: 'Architecture', hint: 'Ancient Egyptian structure' },
            { word: 'DRAGON', category: 'Mythology', hint: 'Fire-breathing creature' },
            { word: 'GUITAR', category: 'Music', hint: 'Six-string instrument' },
            { word: 'RAINBOW', category: 'Nature', hint: 'Colorful arc in sky' },
            { word: 'WIZARD', category: 'Fantasy', hint: 'Magical person' },
            { word: 'PLANET', category: 'Space', hint: 'Orbits a star' },
            { word: 'CASTLE', category: 'Architecture', hint: 'Medieval fortress' },
            { word: 'THUNDER', category: 'Weather', hint: 'Sound after lightning' },
            { word: 'DOLPHIN', category: 'Animals', hint: 'Intelligent sea mammal' },
            { word: 'VOLCANO', category: 'Geography', hint: 'Mountain that erupts' },
            { word: 'JUNGLE', category: 'Nature', hint: 'Dense tropical forest' },
            { word: 'KNIGHT', category: 'History', hint: 'Armored warrior' },
            { word: 'PIRATE', category: 'Adventure', hint: 'Sea robber' }
        ];

        let gameState = {
            currentWord: '',
            category: '',
            hint: '',
            guessedLetters: new Set(),
            correctLetters: new Set(),
            lives: 6,
            score: 0,
            streak: 0,
            isPlaying: false,
            wordsCompleted: 0
        };

        // Game SDK integration
        const gameSDK = {
            ready: () => {
                window.parent.postMessage({ type: 'GAME_READY', payload: {} }, '*');
            },
            updateScore: (score) => {
                window.parent.postMessage({ type: 'SCORE_UPDATE', payload: { score } }, '*');
            },
            gameOver: (data) => {
                window.parent.postMessage({ type: 'GAME_OVER', payload: data }, '*');
            }
        };

        function selectNewWord() {
            const wordData = words[Math.floor(Math.random() * words.length)];
            gameState.currentWord = wordData.word;
            gameState.category = wordData.category;
            gameState.hint = wordData.hint;
            gameState.guessedLetters = new Set();
            gameState.correctLetters = new Set();
            gameState.lives = 6;
        }

        function createKeyboard() {
            const keyboard = document.getElementById('keyboard');
            keyboard.innerHTML = '';
            const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';

            for (let letter of letters) {
                const key = document.createElement('button');
                key.className = 'key';
                key.textContent = letter;
                key.onclick = () => guessLetter(letter);

                if (gameState.guessedLetters.has(letter)) {
                    key.classList.add('used');
                    if (gameState.currentWord.includes(letter)) {
                        key.classList.add('correct');
                    } else {
                        key.classList.add('wrong');
                    }
                    key.disabled = true;
                }

                keyboard.appendChild(key);
            }
        }

        function updateDisplay() {
            // Update word display
            let displayWord = '';
            for (let letter of gameState.currentWord) {
                if (gameState.correctLetters.has(letter)) {
                    displayWord += letter;
                } else {
                    displayWord += '_';
                }
                displayWord += ' ';
            }
            document.getElementById('word-display').textContent = displayWord.trim();

            // Update category
            document.getElementById('category-display').textContent = `Category: ${gameState.category}`;

            // Update hint (show after 3 wrong guesses)
            if (6 - gameState.lives >= 3) {
                document.getElementById('hint-display').textContent = `Hint: ${gameState.hint}`;
            } else {
                document.getElementById('hint-display').textContent = '';
            }

            // Update lives
            const hearts = '‚ù§Ô∏è'.repeat(gameState.lives) + 'üíî'.repeat(6 - gameState.lives);
            document.getElementById('lives-display').textContent = hearts;

            // Update score
            document.getElementById('score-display').textContent = `Score: ${gameState.score}`;

            // Update streak
            if (gameState.streak > 1) {
                document.getElementById('streak-display').textContent = `üî• Streak: ${gameState.streak}`;
            } else {
                document.getElementById('streak-display').textContent = '';
            }
        }

        function guessLetter(letter) {
            if (!gameState.isPlaying || gameState.guessedLetters.has(letter)) return;

            gameState.guessedLetters.add(letter);

            if (gameState.currentWord.includes(letter)) {
                // Correct guess
                gameState.correctLetters.add(letter);
                const points = 10 * (gameState.streak > 0 ? gameState.streak : 1);
                gameState.score += points;
                gameSDK.updateScore(gameState.score);

                // Check if word is complete
                if ([...gameState.currentWord].every(l => gameState.correctLetters.has(l))) {
                    gameState.streak++;
                    gameState.wordsCompleted++;
                    gameState.score += 50 * gameState.streak;
                    gameSDK.updateScore(gameState.score);

                    setTimeout(() => {
                        selectNewWord();
                        createKeyboard();
                        updateDisplay();
                    }, 1000);
                }
            } else {
                // Wrong guess
                gameState.lives--;
                if (gameState.lives <= 0) {
                    endGame(false);
                    return;
                }
            }

            createKeyboard();
            updateDisplay();
        }

        function startGame() {
            gameState = {
                currentWord: '',
                category: '',
                hint: '',
                guessedLetters: new Set(),
                correctLetters: new Set(),
                lives: 6,
                score: 0,
                streak: 0,
                isPlaying: true,
                wordsCompleted: 0
            };

            selectNewWord();
            createKeyboard();
            updateDisplay();

            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('game-over-screen').style.display = 'none';

            // End game after 90 seconds
            setTimeout(() => {
                if (gameState.isPlaying) {
                    endGame(true);
                }
            }, 90000);

            gameSDK.ready();
        }

        function endGame(timeUp) {
            gameState.isPlaying = false;

            const title = timeUp ? "Time's Up!" : "Game Over!";
            document.getElementById('game-over-title').textContent = title;
            document.getElementById('final-score').textContent = `Final Score: ${gameState.score}`;

            let message = `Words Completed: ${gameState.wordsCompleted}`;
            if (!timeUp) {
                message += `\nThe word was: ${gameState.currentWord}`;
            }
            document.getElementById('game-over-message').textContent = message;

            document.getElementById('game-over-screen').style.display = 'flex';

            gameSDK.gameOver({
                score: gameState.score,
                wordsCompleted: gameState.wordsCompleted,
                completed: timeUp
            });
        }

        // Listen for parent commands
        window.addEventListener('message', (event) => {
            if (event.data.type === 'HOST_COMMAND') {
                if (event.data.payload?.command === 'restart') {
                    startGame();
                }
            }
            // Also handle new format
            if (event.data.type === 'REQUEST_RESTART') {
                startGame();
            }
        });

        // Auto-start game when loaded in iframe
        if (window.parent !== window) {
            setTimeout(() => {
                startGame();
            }, 500);
        }
    </script>
</body>
</html>
