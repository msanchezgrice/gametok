<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sky Hop</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(to bottom, #87CEEB 0%, #98D8C8 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }

        #game-container {
            width: 100%;
            max-width: 400px;
            height: 100vh;
            position: relative;
        }

        #game-canvas {
            display: block;
            width: 100%;
            height: 100%;
        }

        #score-display {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 48px;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            z-index: 10;
        }

        #start-screen, #game-over-screen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 100;
        }

        #game-over-screen {
            display: none;
        }

        .game-button {
            margin-top: 20px;
            padding: 18px 40px;
            font-size: 24px;
            font-weight: bold;
            background: linear-gradient(135deg, #FFA500 0%, #FF6347 100%);
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .game-button:active {
            transform: scale(0.95);
        }

        h1 {
            font-size: 48px;
            margin-bottom: 20px;
        }

        #high-score {
            font-size: 20px;
            color: #FFD700;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <canvas id="game-canvas"></canvas>
        <div id="score-display">0</div>

        <div id="start-screen">
            <h1>☁️ Sky Hop</h1>
            <p style="font-size: 20px; margin-bottom: 10px;">Hop through the clouds!</p>
            <p style="font-size: 16px; opacity: 0.8;">Tap to jump and avoid obstacles</p>
            <button class="game-button" onclick="startGame()">START GAME</button>
        </div>

        <div id="game-over-screen">
            <h1>Game Over!</h1>
            <div id="final-score" style="font-size: 36px; margin: 20px 0; color: #FFD700;"></div>
            <div id="high-score"></div>
            <button class="game-button" onclick="startGame()">PLAY AGAIN</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');

        // Set canvas size
        function resizeCanvas() {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        // Game variables
        const GRAVITY = 0.5;
        const JUMP_FORCE = -10;
        const PIPE_SPEED = 3;
        const PIPE_GAP = 150;
        const PIPE_WIDTH = 60;

        let gameState = {
            birdY: canvas.height / 2,
            birdVelocity: 0,
            pipes: [],
            score: 0,
            highScore: 0,
            isPlaying: false,
            gameLoop: null,
            frameCount: 0
        };

        // Game SDK integration
        const gameSDK = {
            ready: () => {
                window.parent.postMessage({ type: 'GAME_READY', payload: {} }, '*');
            },
            updateScore: (score) => {
                window.parent.postMessage({ type: 'SCORE_UPDATE', payload: { score } }, '*');
            },
            gameOver: (data) => {
                window.parent.postMessage({ type: 'GAME_OVER', payload: data }, '*');
            }
        };

        class Pipe {
            constructor() {
                this.x = canvas.width;
                this.topHeight = Math.random() * (canvas.height - PIPE_GAP - 100) + 50;
                this.bottomY = this.topHeight + PIPE_GAP;
                this.passed = false;
            }

            update() {
                this.x -= PIPE_SPEED;
            }

            draw() {
                // Top pipe
                ctx.fillStyle = '#228B22';
                ctx.fillRect(this.x, 0, PIPE_WIDTH, this.topHeight);
                ctx.fillStyle = '#2E7D32';
                ctx.fillRect(this.x - 5, this.topHeight - 30, PIPE_WIDTH + 10, 30);

                // Bottom pipe
                ctx.fillStyle = '#228B22';
                ctx.fillRect(this.x, this.bottomY, PIPE_WIDTH, canvas.height - this.bottomY);
                ctx.fillStyle = '#2E7D32';
                ctx.fillRect(this.x - 5, this.bottomY, PIPE_WIDTH + 10, 30);
            }

            isOffScreen() {
                return this.x + PIPE_WIDTH < 0;
            }

            checkCollision(birdX, birdY, birdSize) {
                if (birdX + birdSize > this.x && birdX < this.x + PIPE_WIDTH) {
                    if (birdY < this.topHeight || birdY + birdSize > this.bottomY) {
                        return true;
                    }
                }
                return false;
            }

            checkPass(birdX) {
                if (!this.passed && birdX > this.x + PIPE_WIDTH) {
                    this.passed = true;
                    return true;
                }
                return false;
            }
        }

        function drawBird() {
            const birdX = canvas.width * 0.2;
            const birdSize = 30;

            // Bird body
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.arc(birdX, gameState.birdY, birdSize / 2, 0, Math.PI * 2);
            ctx.fill();

            // Eye
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(birdX + 5, gameState.birdY - 5, 5, 0, Math.PI * 2);
            ctx.fill();

            ctx.fillStyle = 'black';
            ctx.beginPath();
            ctx.arc(birdX + 7, gameState.birdY - 5, 2, 0, Math.PI * 2);
            ctx.fill();

            // Beak
            ctx.fillStyle = '#FF6347';
            ctx.beginPath();
            ctx.moveTo(birdX + 15, gameState.birdY);
            ctx.lineTo(birdX + 25, gameState.birdY);
            ctx.lineTo(birdX + 15, gameState.birdY + 5);
            ctx.closePath();
            ctx.fill();

            // Wing
            ctx.fillStyle = '#FFA500';
            const wingFlap = Math.sin(gameState.frameCount * 0.2) * 5;
            ctx.beginPath();
            ctx.ellipse(birdX - 5, gameState.birdY + wingFlap, 10, 15, -0.2, 0, Math.PI * 2);
            ctx.fill();
        }

        function drawBackground() {
            // Sky gradient
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#87CEEB');
            gradient.addColorStop(1, '#98D8C8');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Clouds
            ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';
            const cloudOffset = (gameState.frameCount * 0.5) % canvas.width;

            ctx.beginPath();
            ctx.arc(100 - cloudOffset, 100, 30, 0, Math.PI * 2);
            ctx.arc(130 - cloudOffset, 100, 35, 0, Math.PI * 2);
            ctx.arc(160 - cloudOffset, 100, 30, 0, Math.PI * 2);
            ctx.fill();

            ctx.beginPath();
            ctx.arc(300 - cloudOffset + canvas.width, 150, 25, 0, Math.PI * 2);
            ctx.arc(325 - cloudOffset + canvas.width, 150, 30, 0, Math.PI * 2);
            ctx.arc(350 - cloudOffset + canvas.width, 150, 25, 0, Math.PI * 2);
            ctx.fill();
        }

        function update() {
            if (!gameState.isPlaying) return;

            gameState.frameCount++;

            // Update bird physics
            gameState.birdVelocity += GRAVITY;
            gameState.birdY += gameState.birdVelocity;

            // Check boundaries
            if (gameState.birdY < 0 || gameState.birdY > canvas.height) {
                endGame();
                return;
            }

            // Update pipes
            gameState.pipes.forEach(pipe => {
                pipe.update();

                // Check collision
                if (pipe.checkCollision(canvas.width * 0.2, gameState.birdY, 30)) {
                    endGame();
                    return;
                }

                // Check if passed pipe
                if (pipe.checkPass(canvas.width * 0.2)) {
                    gameState.score++;
                    document.getElementById('score-display').textContent = gameState.score;
                    gameSDK.updateScore(gameState.score);
                }
            });

            // Remove off-screen pipes
            gameState.pipes = gameState.pipes.filter(pipe => !pipe.isOffScreen());

            // Add new pipes
            if (gameState.frameCount % 100 === 0) {
                gameState.pipes.push(new Pipe());
            }

            draw();
        }

        function draw() {
            drawBackground();
            gameState.pipes.forEach(pipe => pipe.draw());
            drawBird();
        }

        function jump() {
            if (gameState.isPlaying) {
                gameState.birdVelocity = JUMP_FORCE;
            }
        }

        function startGame() {
            gameState = {
                birdY: canvas.height / 2,
                birdVelocity: 0,
                pipes: [],
                score: 0,
                highScore: gameState.highScore,
                isPlaying: true,
                gameLoop: null,
                frameCount: 0
            };

            document.getElementById('score-display').textContent = '0';
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('game-over-screen').style.display = 'none';

            if (gameState.gameLoop) cancelAnimationFrame(gameState.gameLoop);

            function gameLoop() {
                update();
                if (gameState.isPlaying) {
                    gameState.gameLoop = requestAnimationFrame(gameLoop);
                }
            }
            gameLoop();

            gameSDK.ready();
        }

        function endGame() {
            gameState.isPlaying = false;
            if (gameState.gameLoop) cancelAnimationFrame(gameState.gameLoop);

            if (gameState.score > gameState.highScore) {
                gameState.highScore = gameState.score;
            }

            document.getElementById('final-score').textContent = `Score: ${gameState.score}`;
            document.getElementById('high-score').textContent = `Best: ${gameState.highScore}`;
            document.getElementById('game-over-screen').style.display = 'flex';

            gameSDK.gameOver({
                score: gameState.score,
                highScore: gameState.highScore,
                completed: true
            });
        }

        // Controls
        canvas.addEventListener('click', jump);
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            jump();
        });
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                e.preventDefault();
                jump();
            }
        });

        // Listen for parent commands
        window.addEventListener('message', (event) => {
            if (event.data.type === 'HOST_COMMAND') {
                if (event.data.payload?.command === 'restart') {
                    startGame();
                }
            }
        });

        // Auto-start game when loaded in iframe
        if (window.parent !== window) {
            setTimeout(() => {
                startGame();
            }, 500);
        }
    </script>
</body>
</html>